---
title: Capstone Data Cleaning
author: Siobhan Oberg
date: '2021-08-04'
slug: capstone-data-cleaning
categories:
  - Coding
  - R
  - Capstone
tags:
  - Coding
  - Background
  - Capstone
  - Cleaning
---

Loading Libraries
```{r, echo = FALSE}
library(readr)
library(tidyverse)
library(dplyr)
library(assertive)
library(stringr)
library(lubridate)
library(VIM)
library(maps)
library(ggmap)
library(ggplot2)  
library(rgdal)  
library(raster)
library(sf)
library(leaflet)
```

This code reads in the csv file that has the data in it. You need to enter the pathway to the file so that R can find it. On my computer, the csv file is located in my Downloads folder, which is in my user account on the computer, asoberg, which is in the Users folder.
```{r data}
salem_trees <- read_csv("/Users/asoberg/Downloads/Trees_lat_and_long.csv")
```

The glimpse function gives tou a overview of your data, telling you how many rows, columns, the class of each variable, and the first few observations of each column. Though the variables are listed vertically here, the variables are actually arranged horizontally when you look at the actual data frame.
```{r trees}
glimpse(salem_trees)
```

I wanted to see a count of all the different values for most of the variables. There are a few reasons why.
-See how many different values there are, and to get a count of how many times each value occured.
-See if there were any missing values, to get a count of how many missing values per column.
-See if there were any values that could be compressed into one uniform value, ie replacing a miss spelling of a word with the correct spelling to have be counted towards the correct value count.

To do that, I used the table function, which requires the dataset name and the column name I am interested in. The $ is used to extract a particular column.

I have notes that I wrote to myself about the columns below the table function for each column. 
```{r pressure, echo=FALSE}
table(salem_trees$'Planting Area Type')
```
Most common planting area type is planting strip between sidewalk and road.
```{r}
table(salem_trees$'Planting Area Width in Feet')
```
Need to average out the area width and assign that to the null values.

```{r}
table(salem_trees$'Overhead Utilities')
```
Don't know what these are.

```{r}
table(salem_trees$'Tree Present')
```
Hmmm, were the trees stolen? removed? 

```{r}
table(salem_trees$'Tree Genus/Species')
```
Outcome variable

```{r}
table(salem_trees$Cultivar)
```
Related to outcome variable.

```{r}
table(salem_trees$'Exact DBH in Inches')
```
A feature to maybe help determine species, means diameter at breast height.
```{r}
table(salem_trees$'Tree Health')
```
Only 1 in excellent health. 

```{r}
table(salem_trees$Topped)
```
Top part of tree is cut off, can cause decay, cavaties, hollows.
```{r}
table(salem_trees$Cavities)
```
What are cavities? are they just holes in a tree?
```{r}
table(salem_trees$Fungus)
```
Good that only 72 have fungus, not all fungi growing on your tree are harmful; some do not affect the tree at all while others are even beneficial. Maybe a trend will be revealed after mapping the trees? Is there a specific area of Salem where trees are have fungi?

```{r}
table(salem_trees$'Large Dead Limbs')
```
There are almost no comments, so just remove that whole column.

```{r}
table(salem_trees$Address)
```
Just the street name for the most part, don't know that that would be useful, esp when I also have the lat and long.

```{r}
table(salem_trees$Ward)
```
Don't know what this means.

```{r}
table(salem_trees$UNITTYPE)
```
There are only 408 park trees, 10118 right of way trees, yet they're all city of salem trees?

```{r}
table(salem_trees$PLANTDATE)
```
Not sure this adds much value, why are they all planted on january first? (doubtful this is true) Can I assume the ones with null were planted before 2005?

```{r}
table(salem_trees$STATUS)
```
What? No clue what an active tree is and most of them are null anyway.

```{r}
table(salem_trees$OWNEDBY)
```
All owned by city of salem parks, and I'm sure all maintained by them too (the answer is yes). 

```{r}
table(salem_trees$PWGRID)
```
Remove this column.

```{r}
table(salem_trees$MEMORIALNAME)
```
Remove this column.

```{r}
table(salem_trees$PARK)
```
Majority of trees are not in parks. Leads me to believe that each park maintains their own trees.

```{r}
table(salem_trees$'Planting Notes')
```
This will need a lot of cleaning, if I even want to use planting notes, as most are null
and then lat and long. Might need to change lat and long class.

Decided I don't want to deal with the planting notes, not super important, might be a post for later.

```{r}
less_trees = subset(salem_trees, select = -c(Shape, `Overhead Utilities`, PWGRID, MEMORIALNAME, Comments, Ward, UNITTYPE, OBJECTID, MAINTAINEDBY, OWNEDBY, STATUS, Cultivar, PLANTDATE, `Planting Notes`))
```

This data is suprisingly clean, there aren't different variations of the same thing(no misspellings, weird capitalizations, etc) except in a column I'm not even going to use. 

I will need to transform some variables in numeric from character, create numeric categories etc. 

Making column titles cleaner

I want to make it easier and more efficient to type the column titles. So I fully change the column titles. 

Here, I use the names function to change the names of a few columns to shorter values, as well as to remove the spaces in the column titles. Having spaces in the column titles adds complications to typing out column names. When there are spaces in column names, you need to put '' around the name, which causes R to not suggest the column names when typing them out. I use the <- to write over a value in this example. The <- assigns the the functions, values, etc after it to the value before it.
```{r}
names(less_trees)[names(less_trees) == "Planting Area Type"] <- "pa_type"
names(less_trees)[names(less_trees) == "Planting Area Width in Feet"] <- "pa_width_ft"
names(less_trees)[names(less_trees) == "Tree Present"] <- "tree_present"
names(less_trees)[names(less_trees) == "Tree Genus/Species"] <- "genus_species"
names(less_trees)[names(less_trees) == "Exact DBH in Inches"] <- "DBH_in"
names(less_trees)[names(less_trees) == "Tree Health"] <- "health"
names(less_trees)[names(less_trees) == "Topped"] <- "top"
names(less_trees)[names(less_trees) == "Cavities"] <- "cav"
names(less_trees)[names(less_trees) == "Fungus"] <- "fungus"
names(less_trees)[names(less_trees) == "Large Dead Limbs"] <- "lg_dead_limbs"
names(less_trees)[names(less_trees) == "Address"] <- "address"
names(less_trees)[names(less_trees) == "PARK"] <- "park"
names(less_trees)[names(less_trees) == "LATITUDE"] <- "lat"
names(less_trees)[names(less_trees) == "LONGITUDE"] <- "long"
```

Lowering characters

This bit of cleanup causes all alphabetical characters to be lower case. I use the function tolower to do this. This use of the <- applys a function to all the values in a column. 
```{r}
less_trees$`Planting Area Type`<- tolower(less_trees$`Planting Area Type`)
less_trees$`Planting Area Width in Feet`<- tolower(less_trees$`Planting Area Width in Feet`)
less_trees$`Tree Present`<- tolower(less_trees$`Tree Present`)
less_trees$`Tree Genus/Species`<- tolower(less_trees$`Tree Genus/Species`)
less_trees$`Exact DBH in Inches`<- tolower(less_trees$`Exact DBH in Inches`)
less_trees$`Tree Health`<- tolower(less_trees$`Tree Health`)
less_trees$Topped<- tolower(less_trees$Topped)
less_trees$Cavities<- tolower(less_trees$Cavities)
less_trees$Fungus<- tolower(less_trees$Fungus)
less_trees$`Large Dead Limbs`<- tolower(less_trees$`Large Dead Limbs`)
less_trees$Address<- tolower(less_trees$Address)
less_trees$PARK<- tolower(less_trees$PARK)
```

Changing Null to NA so I can then change the the data types
```{r}
less_trees[less_trees == "<null>"] <- NA
```

visualizing missing data
```{r}
aggr(less_trees, numbers = TRUE, prop = c(TRUE, FALSE))
```

Changing data types from character to numeric
```{r}
less_trees$pa_width_ft <- as.numeric(less_trees$pa_width_ft)
less_trees$DBH_in <- as.numeric(less_trees$DBH_in)
```

replacing NA genus species with unknown
```{r}
less_trees[c("genus_species")][is.na(less_trees[c("genus_species")])] <- "unknown"
```

replacing NA pa type with unknown
```{r}
less_trees[c("pa_type")][is.na(less_trees[c("pa_type")])] <- "unknown"
```

Imputing pa width
```{r}
less_trees$pa_width_ft[is.na(less_trees$pa_width_ft)] <- mean(less_trees$pa_width_ft, na.rm=TRUE)
```

Grouping and imputing DBH
```{r}
aggregate(less_trees[, 5], list(less_trees$genus_species), mean)
```

```{r}
less_trees <- less_trees %>%
    group_by(genus_species) %>%
    mutate(DBH_in = ifelse(is.na(DBH_in), mean(DBH_in, na.rm = TRUE), DBH_in))
```

basic mapping of points
```{r}
prelim_plot <- ggplot(less_trees, aes(x = long, y = lat, 
    colour = park)) +
    #xlim(7540000, 7550000)+
    #ylim(465000, 480000)+
    geom_point()
prelim_plot
```

Fixing lat and long, since they are not actual latitude and longitude
```{r}
salem_lat_long = subset(less_trees, select = c(lat, long))
```

```{r}
salem_lat_long <- salem_lat_long %>% 
    st_as_sf(coords = c("long", "lat"), crs = 2913)
salem_lat_long
```


```{r}
salem_lat_long <- st_transform(salem_lat_long, "+proj=longlat +ellps=WGS84 +datum=WGS84")
```


```{r}
salem_lat_long <- str_split_fixed(salem_lat_long$geometry, ", ", 2)
```


```{r}
salem_lat_long <- as.data.frame(salem_lat_long)
```

```{r}
#long
salem_long <- subset(salem_lat_long, select = c(V1))
salem_long <- str_replace_all(salem_lat_long$V1, "[c(]", "")
salem_long <- as.data.frame(salem_long)
salem_long$salem_long <- as.numeric(as.character(salem_long$salem_long))
id_long <- rownames(salem_long)
salem_long <- cbind(id_long=id_long, salem_long)
```

```{r}
#lat
salem_lat <- subset(salem_lat_long, select = c(V2))
salem_lat <- str_replace_all(salem_lat_long$V2, "[)]", "")
salem_lat <- as.data.frame(salem_lat)
salem_lat$salem_lat <- as.numeric(as.character(salem_lat$salem_lat))
id_lat <- rownames(salem_lat)
salem_lat <- cbind(id_lat=id_lat, salem_lat)
```

rejoining
```{r}
less_trees$lat <- as.numeric(less_trees$lat)
less_trees$long <- as.numeric(less_trees$long)
less_trees1 <- merge(less_trees, salem_lat, by.x="lat", by.y="salem_lat")
id_salem <- rownames(less_trees)
less_trees <- cbind(id_salem=id_salem, less_trees)
less_trees <- less_trees %>% full_join(salem_lat, by = c("id_salem" = "id_lat"))
less_trees <- less_trees %>% full_join(salem_long, by = c("id_salem" = "id_long"))
```

Now removing the bad lat and long, as well as id
```{r}
less_trees = subset(less_trees, select = -c(lat, long, id_salem))
```

renaming salem_lat, salem_long
```{r}
names(less_trees)[names(less_trees) == "salem_lat"] <- "latitude"
names(less_trees)[names(less_trees) == "salem_long"] <- "longitude"
```


Data viz Dataset
```{r}
tree_viz = subset(less_trees, select = c(genus_species, latitude, longitude, fungus, top, health, park, health, lg_dead_limbs))
```

Modelling Dataset
```{r}
tree_model = subset(less_trees, select = c(genus_species, cav, top, health, pa_type,pa_width_ft, fungus, lg_dead_limbs, DBH_in))
```
